---
title: WPS Office Pro（金山WPS企业版）和金山PDF专业版的OEM配置方法
date: 2022-07-15
tags: Windows WPS 版权争议
categories: article
---

## 引子

曾经，互联网上流传着多个“WPS 政府版”，例如：`http://【移除具体链接】/WPS Office 2019 珠海市政府专业版(11.8.2.8506).exe`（目前已 404）。

这些版本均属于金山 WPS 企业版，并且使用 OEM 配置实现各种定制化功能（例如选择部门列表、加载界面 Logo、部分功能定制）。

## 调查

```
名称: WPS Office 2019 珠海市政府专业版(11.8.2.8506).exe
大小: 204752016 字节 (195 MiB)
CRC32: C8542180
CRC64: 0BA5F54C38AF0252
SHA256: 07b87db783e2b5e0fa18ecc5b30afd1ac0dda729d293fe8c5ce3533f4adac02c
SHA1: 55468ca9bc8704a36c4e59e009e3d181a994026b
BLAKE2sp: 317f75c43da8c156f386099c6f50687d8e88aadf4c5226dfdbd06e01befcdffa
```

通过使用`7-Zip`提取样本`WPS Office 2019 珠海市政府专业版(11.8.2.8506).exe`内文件，可以看到以下文件夹：

```
├─$PLUGINSDIR
└─$_11_
```

其中，`$PLUGINSDIR`目录下的文件未见明显作用，`$_11_`目录下的文件是安装程序及 OEM 配置文件。

对于`$_11_`目录下的文件，可以猜测其作用：

```
│  $EXEFILE # 安装程序，可以直接运行，或添加exe后缀名双击运行
│  oem.ini # OEM配置文件
│  oem_enterprise.txt # 未知，可能记录具体企业编号
│  oem_static.exe # 未知，似乎不会在这里用到
│
├─OemFile
│  ├─cfgs
│  │  └─oeminfo
│  │          locateList.txt # 邮编部门列表，按格式可修改
│  │
│  └─oem
│          companylogo.png # 企业Logo，可修改
│
└─oeminfo
        oem.exe # 根据oem.ini配置，猜测为处理OEM配置的程序
        settings.reg # 根据oem.ini配置，猜测为oem.exe会使用的安装时注册表文件
        uninstall.reg # 根据oem.ini配置，猜测为oem.exe会使用的卸载时注册表文件
```

### `oem_enterprise.txt`

```
XXXX_XXXX

```

其中，X 代表一位数字，内容已脱敏。

### `oem.ini`

```ini
;/DWPS_SETUP /DSETUP_ICON=setup_2019_ep

[feature]
【移除非必要内容】


[Support]
Support2016SN=true

[Setup]
Sn=【移除序列号】
UpdateSvrCustomAddress=http://updatepro.wps.cn/updateserver/update
LocateUser=【移除具体OEM名称】
FinishActionFile=oeminfo\oem.exe
FinishActionParameter=/copydir=OemFile\oem /ShellVarContext=current /RelativeDir=INSTDIR /todir='oem'
FinishActionWait=1
FinishActionFile2=oeminfo\oem.exe
FinishActionParameter2=/copydir=OemFile\cfgs\oeminfo /ShellVarContext=current /RelativeDir=INSTDIR /todir='office6\cfgs\oeminfo'
FinishActionWait2=1
PlacedDir3=
FinishActionFile3=oeminfo\oem.exe
FinishActionParameter3=/exefile='office6\cfgs\oeminfo\Install.exe' /ShellVarContext=current /RelativeDir=INSTDIR
FinishActionWait3=1
FinishActionFile4=oeminfo\oem.exe
FinishActionParameter4=/regfile=settings.reg
FinishActionWait4=1
UninstActionFile=office6\cfgs\oeminfo\oem.exe
UninstActionParameter=/regfile=uninstall.reg
UninstActionWait=1
UninstActionFile2=office6\cfgs\oeminfo\oem.exe
UninstActionParameter2=/ShellVarContext=current /RelativeDir=INSTDIR /rmdir='oem'
UninstActionWait2=1
UninstActionFile3=office6\cfgs\oeminfo\oem.exe
UninstActionParameter3=/ShellVarContext=current /RelativeDir=INSTDIR /rmdir='office6\cfgs\oeminfo'
UninstActionWait3=1
InstExeCount=4
UninstExeCount=3

```

其中，`[feature]`疑似配置功能信息，取决于 OEM 需求；

`[Support]`中的`Support2016SN=true`必须存在，下文`[Setup]`的`Sn`才能正常使用；

`LocateUser`一旦存在，安装程序就会在安装前提示用户选择`locateList.txt`中的部门名称，若此文件不存在则会因无法选择导致无法进行下一步安装。

### `settings.reg`

【移除无分析意义的内容】

修改注册表中 WPS 的默认保存格式，推测为本样本安装包 OEM 的需求。

### `uninstall.reg`

【移除无分析意义的内容】

一些卸载注册表的操作。

### `locateList.txt`

```
【移除具体机构名称】


1.【移除六位数邮编】#【移除部门名称】
2.【移除六位数邮编】#【移除部门名称】
【移除不必要的重复举例】


```

第一行为机构名称，空两行，此后格式为：`编号.邮编#部门名称`，每行一个部门，邮编和部门名称可以为空。文件最后的两个空行似乎不是必要的。

因此，如下的示例是可行的：

```
我是机构名称


1.000000#我是部门名称
2.#


```

### 关于 Sn

`oem.ini`中提供的 Sn 不能从 WPS Office 中手动输入注册，其仅可在安装时通过`oem.ini`提供。

## 安装程序和最简 OEM 安装配置

WPS Office Pro 的任意版本安装程序（包括官网提供的试用版）似乎都会尝试获取同目录下的`oem.ini`文件，若存在则会自动使用。

在本文发布之时，官网提供的试用版下载链接为`https://wps-cn-ep.ks3-cn-beijing.ksyun.com/wps/download/ep/WPS2019/WPSPro_11.8.2.11542.exe` [Archive](https://web.archive.org/web/20230117072344/https://wps-cn-ep.ks3-cn-beijing.ksyun.com/wps/download/ep/WPS2019/WPSPro_11.8.2.11813.exe)

因此，最简的可激活 OEM 安装配置方法为：

- 下载官网提供的试用版安装程序
- 在安装程序所在目录下建立`oem.ini`文件，内容为：

```ini
[Support]
Support2016SN=true

[Setup]
Sn=【自行填入序列号】
```

- 运行安装程序

这样，安装程序会自动激活 WPS Office Pro。

## Sn

在研究中，我们使用了从`WPS Office 2019 珠海市政府专业版(11.8.2.8506).exe`中提取的序列号用于测试。

由于 DMCA 等原因，我们不能在这里提供序列号，请自行获取样本安装程序以便手动提取。

`WPSOfficePro` `oem.ini`

## 关于金山 PDF 专业版

金山 PDF 专业版似乎不使用`oem.ini`中的`SN`来获取序列号（但仍从中获取其他配置信息）。在本文发布之时，官网提供的试用版下载链接为`https://zt-pdf.wpscdn.cn/wps/download/ep/PDF/PDFPro_11.8.0.8857.exe`

一个样本是这样的：

```ini
;/DEP_PDF_SETUP /DUSER_LEVEL

[Support]
QingLoginOfflineMode=true
DocTabRoamingGuide=false
CloudFonts=false
CommandTriggerInfoCollect=false
GoogleAnalytics=false
DisableGlobalInfoCollect=true
[Server]
IntranetPluginsAuthServer = "【移除非必要内容】"
IntranetPluginsICServer = "【移除非必要内容】"
[Setup]
SN=【移除序列号，注意这里的没有用】
SnInvisiable=1
PlacedDir=
FinishActionFile=oeminfo\oem.exe
FinishActionParameter=/exefile='office6\ksomisc.exe' /fileparam='-addsn 【移除序列号，注意这里才有用】' /ShellVarContext=current /RelativeDir=INSTDIR
FinishActionWait=1
FinishActionFile2=oeminfo\oem.exe
FinishActionParameter2=/regfile=test.reg
FinishActionWait2=1
UninstActionFile=office6\cfgs\oeminfo\oem.exe
UninstActionParameter=/regfile=xiezai.reg
UninstActionWait=1
InstExeCount=2
UninstExeCount=1
```

另一个样本：

```ini
;/DEP_PDF_SETUP /DUSER_LEVEL

[feature]
【移除非必要内容】

[Support]
IntranetVersion=true
IntranetDrive=false
IntranetPluginsVersion=true
IntranetPluginsAuthType=2
QingLoginOfflineMode=true
DocTabRoamingGuide=false
CloudFonts=false
CommandTriggerInfoCollect=false
GoogleAnalytics=false
EnterpriseDocpermission=true

[Server]
DomainCfgLocalCustomPath = "cfgs/domain.cfg"
IntranetPluginsAuthServer = "【移除非必要内容】"
IntranetPluginsICServer = "【移除非必要内容】"

[Setup]
ProductVersion=【移除具体OEM名称】
StartMenuDir=【移除具体OEM名称】
SnInvisiable=1
UpdateSvrDefaultAddress=【移除非必要内容】
UpdateSvrCustomAddress=【移除非必要内容】
FinishActionFile=oeminfo\oem.exe
FinishActionParameter=/copydir=OemFile\office6 /ShellVarContext=current /RelativeDir=INSTDIR /todir='office6\cfgs'
FinishActionWait=1
PlacedDir2=
FinishActionFile2=oeminfo\oem.exe
FinishActionParameter2=/exefile='office6\ksomisc.exe' /fileparam='-addsn 【移除序列号，注意这里的没有用】' /ShellVarContext=current /RelativeDir=INSTDIR
FinishActionWait2=1
FinishActionFile3=oeminfo\oem.exe
FinishActionParameter3=/regfile=【移除非必要内容】
FinishActionWait3=1
UninstActionFile=office6\cfgs\oeminfo\oem.exe
UninstActionParameter=/regfile=test.reg
UninstActionWait=1
InstExeCount=3
UninstExeCount=1
```

根据`FinishActionParameter`行，我们很容易推断出，这个配置可以手动完成。即在 WPS PDF 安装目录`C:\Program Files (x86)\Kingsoft\Kingsoft PDF\版本号\`下执行`.\office6\ksomisc.exe -addsn 【移除序列号，注意这里才有用】`。

尽管如此，和金山 WPS 企业版不同的是，WPS PDF 的序列号仍然需要联网认证才能正常使用。

## 2023

上述内容不适用 2023 版本。

`https://wps-cn-ep.wpscdn.cn/wps/download/ep/WPS2023/WPSPro_12.8.2.18205.exe` (需要 Referer 为`https://ep.wps.cn/downloads`) [Archive](https://web.archive.org/web/20240927061534/https://wps-cn-ep.wpscdn.cn/wps/download/ep/WPS2023/WPSPro_12.8.2.18205.exe)

## 也参考

[2019 from 423down](https://www.423down.com/8890.html)

```ini
[Product]
FileRoaming/DefaultRoamingMode=auto

[support]
OCRTool=true
EnablePdf2WordV2=true
EnableProcessonMind=true
EnableProcessonFlow=true
IsSupportPhoto2pdf=true
Update=false ;禁止版本检测升级
Support2016SN=true ;启用序列号
NseVisible=true ;安装VB组件工具
WPSPlusVersion=true ;显示增强版
#EnableCloudDocs=false ;不显示WPS云文档
#EnableAccount=false ;不显示账户登陆中心
IntranetDrive=true ;不显示我的电脑WPS云盘
EnterpriseDocpermission=true ;启用企业版文档权限
EnablePlainWatermarkInfo=false ;输出打印无水印信息
IsCreateNewFile=1 ; 整合模式实现（打开应用即进入编辑模式）
DisableWPSPdfDeskTopShortcut=true ;不创建桌面PDF快捷方式
FileDialogDefWpsCloud=false ;保存对话框可自定义WPS云文档
OnlineWithoutCloudDoc=false ;不显示广告 (日历, WPS便签, 会议, 统计表单)

[Setup]
SendInstallSource=1 ;检测安装包
Silent=0 ;0带界面标准安装，1无界面静默安装
Sn=TJ3GN-9NTGQ-GLF7C-YEN8X-TJWML ;终身授权序列号
SourceDir=oeminfo ;源目录支持读取企业OEM配置文件安装
```

[WPS VBA 安装程序备份](/assets/postres/2022-07-15-wps-oem/VBA_Setup.exe)

[2023 from 423down](https://www.423down.com/15937.html)

```ini
#WPS Office自定义程序功能配置文件(oem.ini)
#将oem.ini放置到WPS官方安装包同一路径使用

[support]
OCRTool=true
XiuTang=false
WeiboPlugin=true
EnablePdf2WordV2=true
EnableProcessonMind=true
EnableProcessonFlow=true
IsSupportPhoto2pdf=true
WPSPlusVersion=true ;显示增强版
NseVisible=true  ;安装VB组件工具
Update=false     ;禁止版本检测升级
#EnableCloudDocs=false ;不显示WPS云文档
#CloudDocOnline=false ;不显示WPS云文档
#EnableCloudService=false ;不安装云服务
#EnableAccount=false ;不显示账户登陆中心
IntranetDrive=true ;不显示我的电脑WPS云盘
#EnableOnlineFunction=false ;不显示在线模板
EnterpriseDocpermission=true ;启用企业版文档权限
EnablePlainWatermarkInfo=true ;输出打印无水印信息
Prometheus=false ;禁用整合模式(打开应用需要手动新建文件)
IsCreateNewFile=1 ; 整合模式实现（打开应用即进入编辑模式）
Support2016SN=true ;启用序列号(11.8.2.12287 版开始已失效)
DisableWPSPdfDeskTopShortcut=true ;不创建桌面PDF快捷方式
FileDialogDefWpsCloud=false  ;保存对话框可自定义WPS云文档
OnlineWithoutCloudDoc=false  ;不显示广告 (日历, WPS便签, 会议, 统计表单)
WeChatCustomerService=false  ;不显示工具栏WPS客服微信按钮
EnableWPSOfficialWebsite=false ;不显示工具栏WPS官网入口按钮
UpdateSvrCustomAddress=http://0.0.0.0/wpsoffice/updateserver/update #屏蔽升级
caSM7oYrI4vjjbzpO04RdA..=NsbhfV4nLv_oZGENyLSVZA..
#JYcm_wejKY0DbtmzYoUk5Q..=NsbhfV4nLv_oZGENyLSVZA..  ;不显示界面登陆按钮(适用2023)
#FVOPKYNb5aR8Z9wAKwqn_w..=NsbhfV4nLv_oZGENyLSVZA..  ;不显示账户登陆功能(适用2023)
VaRJdz9TqngvP2rCk3bf-dH_HWpeBrG_9hpfdL1oM7Y.=NsbhfV4nLv_oZGENyLSVZA..  ;不显示工具栏WPS客服微信按钮(适用2023)
XAoSmN4Dk8PJG50puLaNe-iIrz2EFPJoaiSwWCbv1_A.=NsbhfV4nLv_oZGENyLSVZA..  ;不显示广告 (日历, WPS便签, 会议, 统计表单)(适用2023)
uHggomDKEaVGML_Zzoprjw..=NsbhfV4nLv_oZGENyLSVZA..
PZ8bJ6Ee7I1QgyE_ecJvbiWJqbfBIQrcAzfOWLgeT1c.=WHfH10HHgeQrW2N48LfXrA..
jko0IwcTvUkzCbPvis6rUIxF_x6CEcMTNTiM8kp_W9A.=NsbhfV4nLv_oZGENyLSVZA..
#vMVENEUpsDRRrn9w2_8R4g..=NsbhfV4nLv_oZGENyLSVZA..


[Setup]
SendInstallSource=1 ;检测安装包
Silent=0 ;0带界面标准安装，1无界面静默安装
Sn=TJ3GN-9NTGQ-GLF7C-YEN8X-TJWML ;终身授权序列号
SourceDir=oeminfo ;源目录支持读取企业OEM配置文件安装
UpdateSvrDefaultAddress=http://127.0.0.1 ;升级服务默认服务器
Kr0cNR1nKpC7yGiK-_5E2w..=yrogMsuo-CgeSd6yrWZsOBiJUkFphK4lPxYTSyyRgqc.
StartMenuDir=WPS Office 专业增强版
ProductVersion=专业增强版


[Auth]
#自定义登录账户服务器，不需屏蔽登录功能改为0.0.0.0
LicenseServerUrl=http://wps.mycustom.server/account
#自定义序列号检查服务器
KSNUpdateServerUrl=http://0.0.0.0

[Server]
# 屏蔽在线检测升级服务器
UpdateServer=http://127.0.0.1
# 屏蔽升级信息收集服务器
AutoNomInfoSvr=http://0.0.0.0/wpscollect
# 屏蔽金山文档内网服务器
QingUrl=http://0.0.0.0
# 屏蔽个人信息收集服务器
InfoCollectServer=http://0.0.0.0/wpsv6internet/infos.ads
# 屏蔽增值数据收集服务器
IntranetPluginsICServer=http://0.0.0.0/xva/v1/plugin/stat
# 定义在线检测升级服务器
CustomUpdateServer=http://0.0.0.0/wpsoffice/updateserver/update
```
