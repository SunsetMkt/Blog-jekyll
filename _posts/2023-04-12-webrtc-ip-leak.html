---
title: "WebRTC泄露用户IP演示"
date: 2023-04-12
tags: demo 前端 Web
categories: demo
excerpt: "使用stun.l.google.com:19302"
---

<!-- https://raw.githubusercontent.com/VoidSec/WebRTC-Leak/master/exploit.js -->

<div id="showcase"></div>

<script>
    function findIP(onNewIP) {
        const myPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
        const pc = new myPeerConnection({ iceServers: [{ urls: "stun:stun.l.google.com:19302" }] });

        pc.createDataChannel("");

        pc.createOffer().then(function (sdp) {
            const lines = sdp.sdp.split('\n');
            const addresses = [];
            lines.forEach(function (line) {
                if (line.indexOf('candidate') === -1) return;
                const parts = line.split(' ');
                const addr = parts[4];
                if (addr !== '') {
                    addresses.push(addr);
                }
            });
            if (addresses.length > 0) {
                onNewIP(addresses);
            }
            pc.setLocalDescription(sdp);
        });

        pc.onicecandidate = function (event) {
            if (!event.candidate) return;
            const parts = event.candidate.candidate.split(' ');
            const addr = parts[4];
            if (addr !== '') {
                onNewIP([addr]);
            }
        };
    }

    const showcase = document.getElementById('showcase');
    const ul = document.createElement('ul');
    ul.textContent = '您的IP地址：';
    showcase.appendChild(ul);

    function addIP(addresses) {
        console.log('got addresses: ', addresses);
        const li = document.createElement('li');
        li.textContent = addresses.join(', ');
        ul.appendChild(li);
    }

    findIP(addIP);
</script>